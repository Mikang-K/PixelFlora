# **ğŸ“‹ í”„ë¡œì íŠ¸ ëª…ì„¸ì„œ: Pixel Flora (í”½ì…€ í”Œë¡œë¼)**

<aside>
ğŸ’¡

**ë¶€ì œ:** ë¶„ì‚° ì‹œìŠ¤í…œ ê¸°ë°˜ì˜ ì‹¤ì‹œê°„ í˜‘ë™ í”½ì…€ ì•„íŠ¸ ì •ì›

</aside>

## **1. í”„ë¡œì íŠ¸ ê°œìš”**

ì‚¬ìš©ìê°€ ì›¹ ìº”ë²„ìŠ¤ì— í´ë¦­í•˜ì—¬ í”½ì…€ ê½ƒì„ í”¼ìš°ëŠ” ì¸í„°ë™í‹°ë¸Œ ê²Œì„ì…ë‹ˆë‹¤. ê° ì ‘ì† ìš”ì²­ì€ **ë¡œë“œë°¸ëŸ°ì„œ(ALB)**ë¥¼ í†µí•´ ì—¬ëŸ¬ **EC2 ì¸ìŠ¤í„´ìŠ¤**ë¡œ ë¶„ì‚°ë˜ë©°, ê° ì¸ìŠ¤í„´ìŠ¤ëŠ” ê³ ìœ í•œ ìƒ‰ìƒ ê³„í†µì„ ê°€ì§‘ë‹ˆë‹¤. ì„œë²„ ë¶€í•˜ê°€ ë†’ì•„ì§€ë©´ **ì˜¤í† ìŠ¤ì¼€ì¼ë§(ASG)**ì´ ì‘ë™í•˜ì—¬ ìƒˆë¡œìš´ ìƒ‰ìƒì˜ ê½ƒì„ í”¼ìš°ëŠ” ì„œë²„ê°€ ìë™ìœ¼ë¡œ íˆ¬ì…ë©ë‹ˆë‹¤.

---

## **2. ì£¼ìš” ê¸°ëŠ¥ (Core Features)**

### **ğŸŒ¸ ì‹¤ì‹œê°„ í”½ì…€ ê°€ë“œë‹**

- **í´ë¦­ ì´ë²¤íŠ¸:** ìº”ë²„ìŠ¤ í´ë¦­ ì‹œ í•´ë‹¹ ì¢Œí‘œì— í”½ì…€ í˜•íƒœì˜ ê½ƒ ìƒì„±.
- **ìƒ‰ìƒ í˜¼í•©:** ì´ë¯¸ í”¼ì–´ìˆëŠ” ë‹¤ë¥¸ ìƒ‰ìƒì˜ ê½ƒì„ í´ë¦­í•  ê²½ìš°, ë‘ ìƒ‰ìƒì´ ì„ì¸ ì¤‘ê°„ ìƒ‰ í”½ì…€ ìƒì„±.
    
    ![Image](https://github.com/user-attachments/assets/4bc36beb-af44-49c7-af07-16b2c7e31e22)

### **ğŸ“ˆ ì˜¤í† ìŠ¤ì¼€ì¼ë§ ì‹œê°í™”**

- **ë¶€í•˜ ìœ ë°œ (Storm Mode):** ì‚¬ìš©ìê°€ 'í­í’ìš°' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì„œë²„ì—ì„œ ë³µì¡í•œ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ì—¬ CPU ì ìœ ìœ¨ ê¸‰ì¦.
- **ë™ì  í™•ì¥:** CPU ì„ê³„ì¹˜ ì´ˆê³¼ ì‹œ ASGê°€ ìƒˆ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹¤í–‰. ì ì‹œ í›„ ìº”ë²„ìŠ¤ì— **ìƒˆë¡œìš´ ìƒ‰ìƒì˜ ê½ƒ**ì´ ë“±ì¥í•˜ë©° ì‹œìŠ¤í…œ ì•ˆì •í™” ì‹œê°í™”.
- **ì„œë²„ ì¢…ë£Œ (Scale-in):** ë¶€í•˜ ê°ì†Œë¡œ ì„œë²„ê°€ ì¢…ë£Œë˜ë©´ í•´ë‹¹ ìƒ‰ìƒì˜ ê½ƒë“¤ì´ íšŒìƒ‰(Grayscale)ìœ¼ë¡œ ë³€í•¨.

<img width="1889" height="897" alt="Image" src="https://github.com/user-attachments/assets/b9489fdf-d900-4095-b0df-34d901f4e72c" />

<p align="center">
    <img src="https://github.com/user-attachments/assets/d1a345cc-020d-4fbb-a556-76c84fa4b667" width="33%"/>
    <img src="https://github.com/user-attachments/assets/7e115fd6-dc0f-49bc-8c29-9b2833a54ce8" width="33%"/>
    <img src="https://github.com/user-attachments/assets/0614f9a6-bd84-45db-be24-cf694a22983d" width="33%"/>
</p>
---

## **3. ê¸°ìˆ  ìŠ¤íƒ (Tech Stack)**

| **êµ¬ë¶„** | **ê¸°ìˆ ** | **ì—­í• ** |
| --- | --- | --- |
| **Frontend** | Vite, React, Canvas API | í”½ì…€ ë Œë”ë§ ë° ì‹¤ì‹œê°„ ì¸í„°ë ‰ì…˜ |
| **Backend** | Node.js (Express) | API ì²˜ë¦¬ ë° ì„œë²„ ê³ ìœ  ID/ìƒ‰ìƒ ë°˜í™˜ |
| **Real-time** | Socket.io | ì—¬ëŸ¬ ì‚¬ìš©ì ê°„ì˜ ê½ƒ ì¢Œí‘œ ë™ê¸°í™” |
| **Infrastructure** | AWS (ALB, ASG, EC2), Terraform | ë¡œë“œë°¸ëŸ°ì‹± ë° ìë™ í™•ì¥ í™˜ê²½ êµ¬ì¶• |
| **Database** | Redis (ElastiCache) | ëª¨ë“  ì„œë²„ê°€ ê³µìœ í•˜ëŠ” ê½ƒì˜ ìœ„ì¹˜/ìƒ‰ìƒ ë°ì´í„° ì €ì¥ |
| **ë¡œì»¬ ê°œë°œ** | Docker Compose (Redis ì»¨í…Œì´ë„ˆ) |  |

---

## **4. ì•„í‚¤í…ì²˜ ë° ë°ì´í„° íë¦„**
<p align="center">
    <img src="https://github.com/user-attachments/assets/9d6141bd-8aea-4218-b8af-2f34fb6ef13" width="50%"/>
    <img src="https://github.com/user-attachments/assets/07b6df93-50ec-4154-aed5-393a168a1714" witdh="50%"/>
</p>

1. **ì‚¬ìš©ì ì ‘ì†:** ALB DNSë¡œ ì ‘ì† ì‹œ, ALBê°€ í˜„ì¬ í™œì„±í™”ëœ EC2 ì¤‘ í•˜ë‚˜ë¡œ ì—°ê²°.
2. **ì„œë²„ ì‹ë³„:** ê° EC2ëŠ” ì‹œì‘ ì‹œ ìì‹ ì˜ `Instance ID`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê³ ìœ  ìƒ‰ìƒ(Red, Blue ë“±)ì„ ê²°
3. **ë°ì´í„° ê³µìœ :** * ì‚¬ìš©ìê°€ ê½ƒì„ í”¼ìš°ë©´ ì„œë²„ëŠ” í•´ë‹¹ ì¢Œí‘œì™€ ìƒ‰ìƒì„ **Redis**ì— ì €ì¥.
    - Redisì˜ Pub/Sub ê¸°ëŠ¥ì„ í†µí•´ ëª¨ë“  ì„œë²„ì— ì ‘ì† ì¤‘ì¸ ì‚¬ìš©ìì—ê²Œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì „ì†¡.
4. **í™•ì¥ì„±:** CloudWatchê°€ CPU ì‚¬ìš©ëŸ‰ì„ ê°ì‹œ.
    - ë¶€í•˜ ë°œìƒ ì‹œ ASGê°€ ìƒˆ EC2ë¥¼ ë„ìš°ê³ , ALBê°€ ì´ë¥¼ ê°ì§€í•´ ìƒˆë¡œìš´ ìƒ‰ìƒ(ì˜ˆ: ë…¸ë€ìƒ‰)ì˜ íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•˜ê¸° ì‹œì‘.

## ì „ì²´ ë””ë ‰í„°ë¦¬ êµ¬ì¡°

```
/PixelFlora/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main.jsx
â”‚       â”œâ”€â”€ App.jsx
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ Canvas.jsx          # Canvas API í”½ì…€ ë Œë”ë§ (í•µì‹¬)
â”‚       â”‚   â”œâ”€â”€ ServerInfo.jsx      # ì—°ê²°ëœ ì¸ìŠ¤í„´ìŠ¤ ì •ë³´ í‘œì‹œ
â”‚       â”‚   â”œâ”€â”€ StormButton.jsx     # CPU ë¶€í•˜ ìœ ë°œ ë²„íŠ¼
â”‚       â”‚   â””â”€â”€ InstanceLegend.jsx  # ìƒ‰ìƒ-ì¸ìŠ¤í„´ìŠ¤ ë²”ë¡€
â”‚       â”œâ”€â”€ hooks/
â”‚       â”‚   â”œâ”€â”€ useSocket.js        # Socket.io ì—°ê²°Â·ì´ë²¤íŠ¸ ê´€ë¦¬
â”‚       â”‚   â””â”€â”€ useCanvas.js        # Canvas ë“œë¡œì‰ ë¡œì§
â”‚       â””â”€â”€ utils/
â”‚           â”œâ”€â”€ colorMixer.js       # ìƒ‰ìƒ í˜¼í•©Â·íšŒìƒ‰í™” ë¡œì§
â”‚           â””â”€â”€ pixelFlower.js      # 5x5 ê½ƒ í”½ì…€ íŒ¨í„´
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ server.js
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ redis.js                # ioredis í´ë¼ì´ì–¸íŠ¸ 2ê°œ (ì¼ë°˜ìš© + Pub/Subìš©)
â”‚   â”‚   â””â”€â”€ instanceConfig.js       # EC2 ì¸ìŠ¤í„´ìŠ¤ â†’ ìƒ‰ìƒ ê²°ì • (í•µì‹¬)
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ api.js
â”‚   â”‚   â””â”€â”€ health.js               # ALB Health Check
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ pixelService.js         # Redis HSET/HGETALL + ìƒ‰ìƒ í˜¼í•©
â”‚   â”‚   â”œâ”€â”€ redisPublisher.js       # Redis PUBLISH
â”‚   â”‚   â”œâ”€â”€ redisSubscriber.js      # Redis SUBSCRIBE â†’ io.emit (ë©€í‹° ì¸ìŠ¤í„´ìŠ¤ í•µì‹¬)
â”‚   â”‚   â””â”€â”€ stormService.js         # Worker Thread CPU ë¶€í•˜
â”‚   â”œâ”€â”€ socket/
â”‚   â”‚   â””â”€â”€ socketHandler.js        # Socket.io ì´ë²¤íŠ¸ í—ˆë¸Œ
â”‚   â””â”€â”€ scripts/
â”‚       â””â”€â”€ stressCpu.js            # CPU ìŠ¤íŠ¸ë ˆìŠ¤ ì›Œì»¤
â”‚
â””â”€â”€ infrastructure/
    â”œâ”€â”€ main.tf
    â”œâ”€â”€ variables.tf
    â”œâ”€â”€ outputs.tf
    â”œâ”€â”€ modules/
    â”‚   â”œâ”€â”€ networking/             # VPC, Subnet, Security Groups
    â”‚   â”œâ”€â”€ compute/                # EC2 Launch Template, ASG, ALB, Scaling Policy
    â”‚   â””â”€â”€ database/               # ElastiCache Redis (ì„ íƒì )
    â””â”€â”€ user_data/
        â””â”€â”€ startup.sh              # EC2 ë¶€íŒ… ì‹œ ì•± ìë™ ì‹œì‘
```

## Redis ë°ì´í„° ìŠ¤í‚¤ë§ˆ

`# í”½ì…€ ë§µ (Hash)
KEY:   pixels
FIELD: "x:y"          ì˜ˆ) "42:31"
VALUE: JSON           {"color":"#FF4444","instanceId":"i-0abc123","timestamp":1708400000}

# ì¸ìŠ¤í„´ìŠ¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ (Hash)
KEY:   instances
FIELD: instanceId
VALUE: JSON           {"color":"#FF4444","theme":"red","lastSeen":1708400000,"active":true}

# Pub/Sub ì±„ë„
CHANNEL: pixel-events
ë©”ì‹œì§€ íƒ€ì…:
  { "type": "PIXEL_PLACED", "x": 42, "y": 31, "color": "#FF4444", "instanceId": "..." }
  { "type": "PIXEL_MIXED",  "x": 42, "y": 31, "color": "#AA2288", "instanceId": "..." }
  { "type": "GRAYSCALE",    "instanceId": "..." }  # ì¸ìŠ¤í„´ìŠ¤ ì¢…ë£Œ ì‹œ`

---

## API ì„¤ê³„

### REST API

| Method | Path | ìš©ë„ |
| --- | --- | --- |
| GET | /health | ALB Health Check â†’ { status, instanceId, color } |
| GET | /api/pixels | ì „ì²´ í”½ì…€ ë§µ ë°˜í™˜ |
| GET | /api/server-info | í˜„ì¬ ì¸ìŠ¤í„´ìŠ¤ ìƒ‰ìƒ/ID |
| POST | /api/storm/start | CPU ë¶€í•˜ ì‹œì‘ |
| POST | /api/storm/stop | CPU ë¶€í•˜ ì¤‘ë‹¨ |

### Socket.io ì´ë²¤íŠ¸

| ë°©í–¥ | ì´ë²¤íŠ¸ | ë°ì´í„° |
| --- | --- | --- |
| Sâ†’C | `server:info` | `{ instanceId, color: { primary, secondary, theme } }` |
| Sâ†’C | `pixels:init` | `{ "x:y": { color, instanceId, timestamp }, ... }` |
| Sâ†’C | `pixel:update` | `{ type, x, y, color, instanceId }` |
| Sâ†’C | `instance:join` | `{ instanceId, color }` |
| Sâ†’C | `instance:leave` | `{ instanceId }` |
| Câ†’S | `pixel:place` | `{ x: number, y: number }` |
| Câ†’S | `storm:start` | `{ durationMs: number }` |
| Câ†’S | `storm:stop` | `{}` |

---

## **5. ë‹¨ê³„ë³„ êµ¬í˜„ ê³„íš**

1.  **1ë‹¨ê³„ (MVP):** ë‹¨ì¼ EC2ì—ì„œ ìº”ë²„ìŠ¤ì— ì  ì°ê¸° êµ¬í˜„ + Redis ì—°ë™.
2. **2ë‹¨ê³„ (AWS êµ¬ì¶•):** AMI ìƒì„± í›„ ALBì™€ ASG ì„¤ì •. ìˆ˜ë™ìœ¼ë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ëŠ˜ë ¤ë³´ë©° ìƒ‰ìƒì´ ë°”ë€ŒëŠ”ì§€ í™•ì¸.
3. **3ë‹¨ê³„ (ë™ê¸°í™”):** Socket.ioë¥¼ í™œìš©í•´ ì„œë¡œ ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•œ ìœ ì €ë¼ë¦¬ ê½ƒì´ ë³´ì´ëŠ”ì§€ í…ŒìŠ¤íŠ¸.
4. **4ë‹¨ê³„ (ê³ ë„í™”):** CPU ë¶€í•˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± ë° ì˜¤í† ìŠ¤ì¼€ì¼ë§ ì •ì±…(Target Tracking) ìµœì í™”.

### Phase 1 â€” MVP (ë¡œì»¬ ë‹¨ì¼ ì„œë²„ + Redis)

**ëª©í‘œ:** í´ë¦­ â†’ Redis ì €ì¥ â†’ ì‹¤ì‹œê°„ ë™ê¸°í™” ë™ì‘ í™•ì¸

`Backend:
â–¡ backend/package.json (express, socket.io, ioredis, cors)
â–¡ backend/config/redis.js
â–¡ backend/config/instanceConfig.js
â–¡ backend/services/pixelService.js  â† HSET/HGETALL + ìƒ‰ìƒ í˜¼í•©
â–¡ backend/services/redisPublisher.js
â–¡ backend/services/redisSubscriber.js  â† Pub/Sub â†’ io.emit (í•µì‹¬)
â–¡ backend/socket/socketHandler.js
â–¡ backend/routes/health.js
â–¡ backend/routes/api.js
â–¡ backend/server.js

Frontend:
â–¡ frontend/package.json (vite, react, socket.io-client)
â–¡ frontend/src/utils/colorMixer.js   â† RGB í˜¼í•©, íšŒìƒ‰í™”
â–¡ frontend/src/utils/pixelFlower.js  â† 5x5 ê½ƒ íŒ¨í„´
â–¡ frontend/src/hooks/useSocket.js
â–¡ frontend/src/components/Canvas.jsx â† í•µì‹¬ ì»´í¬ë„ŒíŠ¸
â–¡ frontend/src/components/ServerInfo.jsx
â–¡ frontend/src/App.jsx

ê³µí†µ:
â–¡ docker-compose.yml
â–¡ .env.example
â–¡ .gitignore`

**ê²€ì¦:** ë¸Œë¼ìš°ì € 2ê°œ(3001/3002 í¬íŠ¸ ê°ê°)ì—ì„œ í•œìª½ í´ë¦­ ì‹œ ì–‘ìª½ì— ê½ƒ ë“±ì¥

### Phase 2 â€” AWS ì¸í”„ë¼ (Terraform)

**ëª©í‘œ:** AMI ìƒì„± â†’ Terraformìœ¼ë¡œ ALB + ASG ë°°í¬

`â–¡ backend/Dockerfile
â–¡ frontend/Dockerfile + nginx.conf
â–¡ infrastructure/modules/networking/main.tf  (VPC, Subnet, SG)
â–¡ infrastructure/modules/compute/main.tf     (LT, ASG, ALB, Scaling Policy)
â–¡ infrastructure/modules/database/main.tf    (ElastiCache Redis)
â–¡ infrastructure/user_data/startup.sh        (Node.js ì„¤ì¹˜ + systemd ë“±ë¡)
â–¡ infrastructure/main.tf, variables.tf, outputs.tf

AWS ìˆ˜ë™ ì‘ì—…:
  1. EC2ì—ì„œ ì•± ì„¤ì¹˜ í›„ AMI ìƒì„±
  2. ElastiCache Redis í´ëŸ¬ìŠ¤í„° ìƒì„± (t3.micro)
  3. terraform init â†’ plan â†’ apply

ALB WebSocket ì£¼ì˜:
  - idle_timeout = 3600 (WebSocket ì¥ê¸° ì—°ê²°)
  - Sticky Session ë¹„í™œì„±í™” (Redis ì¤‘ì•™ ì €ì¥ì†Œ ì‚¬ìš©)`

### Phase 3 â€” Socket.io ë©€í‹° ì¸ìŠ¤í„´ìŠ¤ ë™ê¸°í™”

**ëª©í‘œ:** ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ì— ì—°ê²°ëœ ì‚¬ìš©ì ê°„ ì‹¤ì‹œê°„ ë™ê¸°í™” í™•ì¸

`â–¡ Redis Pub/Sub ë©€í‹° ì¸ìŠ¤í„´ìŠ¤ ì‹¤ì œ í™˜ê²½ í…ŒìŠ¤íŠ¸
â–¡ ALB WebSocket ì§€ì› ì„¤ì • í™•ì¸ (Upgrade í—¤ë”)
â–¡ ì‹ ê·œ ì¸ìŠ¤í„´ìŠ¤ ì ‘ì† ì‹œ pixels:init ë¡œ ê¸°ì¡´ í”½ì…€ ë¡œë“œ í™•ì¸
â–¡ InstanceLegend ì»´í¬ë„ŒíŠ¸ (í™œì„± ì¸ìŠ¤í„´ìŠ¤ ìƒ‰ìƒ ë²”ë¡€)
â–¡ instance:join / instance:leave ì´ë²¤íŠ¸ êµ¬í˜„`

### Phase 4 â€” ê³ ë„í™” (Storm Mode + Auto Scaling ì‹œê°í™”)

**ëª©í‘œ:** CPU ë¶€í•˜ â†’ Auto Scaling â†’ ì‹œê°ì  í™•ì¸

`â–¡ backend/scripts/stressCpu.js        (Worker Thread ê¸°ë°˜)
â–¡ backend/services/stormService.js    (CPU Ã— Core ìˆ˜ë§Œí¼ Worker ì‹¤í–‰)
â–¡ frontend/src/components/StormButton.jsx

Graceful Shutdown (ì¸ìŠ¤í„´ìŠ¤ ì¢…ë£Œ ì‹œê°í™” í•µì‹¬):
â–¡ SIGTERM ìˆ˜ì‹  â†’ grayscaleByInstance() í˜¸ì¶œ
â–¡ Redis PUBLISH { type: 'GRAYSCALE', instanceId }
â–¡ 2ì´ˆ ëŒ€ê¸° í›„ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
â–¡ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•´ë‹¹ ìƒ‰ìƒ ê½ƒ â†’ íšŒìƒ‰ ì „í™˜

Auto Scaling ì •ì±… (Terraform):
â–¡ TargetTrackingScaling: CPU 60% ì´ˆê³¼ ì‹œ ìŠ¤ì¼€ì¼ ì•„ì›ƒ
â–¡ CloudWatch ëŒ€ì‹œë³´ë“œ ì„¤ì •`

---

## ì‘ì—… ë‚´ì—­

- **26.02.20**
    - **MVP (ë¡œì»¬ ë‹¨ì¼ ì„œë²„ + Redis) êµ¬í˜„**
        
        
        ![image.png](attachment:97b38358-6009-43d8-85eb-86fdaff35593:image.png)
        
        ![image.png](attachment:3f79c82a-5a6d-4637-9d7e-bdbefb64553f:image.png)
        
    - **AWS ì¸í”„ë¼(Terraform) ìƒì„±**
        
        **AMI ìƒì„± â†’ Terraformìœ¼ë¡œ  ALB + ASG ë°°í¬**
        
        ![image.png](attachment:dd8e7222-7508-4ce6-bfad-015e93fd79eb:image.png)
        
        ![image.png](attachment:edfdf567-2a06-4c38-a316-1f59d7ec1e02:image.png)
        
    - **íŠ¸ëŸ¬ë¸”ìŠˆíŒ…**
        
        AWSì— ë°°í¬ í›„ 500 (Internal Server Error)ì™€ í•¨ê»˜ì ‘ì†ì— ì´ìƒì´ ìƒê¹€.
        
        **ì›ì¸:** `setup_ami_base.sh`ë¡œ AMIë¥¼ ë§Œë“¤ ë•Œ cloud-init ì‹¤í–‰ ê¸°ë¡ì´ ì´ë¯¸ì§€ì— ê°™ì´ êµ¬ì›Œì§ìœ¼ë¡œ ì¸í•´ ìƒˆ ì¸ìŠ¤í„´ìŠ¤ê°€ ëœ° ë•Œ cloud-initì´ "ì´ë¯¸ ì‹¤í–‰í–ˆìŒ"ìœ¼ë¡œ íŒë‹¨í•˜ê³  `startup.sh`(user_data)ë¥¼ **ê±´ë„ˆëœ€.** í•´ë‹¹ ë¬¸ì œë¡œ ì¸í•´ ì„œë¹„ìŠ¤ëŠ” enableë§Œ ë˜ê³  .env íŒŒì¼ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ
        
        **í•´ê²° ë°©ì‹**: setup_ami_base.shì— ìºì‹œ ì‚­ì œ ëª…ë ¹ì–´ ì¶”ê°€.
        
        ```bash
        cloud-init clean --logs
        ```
        
        **ê²°ê³¼:** ì¸ìŠ¤í„´ìŠ¤ì— .env ì„¤ì¹˜ì™€ ì‹œìŠ¤í…œ ì •ìƒ ì„¤ì¹˜ ë° ì‹¤í–‰ í™•ì¸ë¨. ê·¸ëŸ¼ì—ë„ ë¡œë“œë°¸ëŸ°ì„œë¥¼ í†µí•œ ì ‘ì†ì´ ì•ˆ ë¨. 
        
        ```bash
        [ec2-user@ip-10-0-1-154 ~]$ curl -s http://localhost:3001/health
        {"status":"ok","instanceId":"i-0518393b438c2882a","color":{"primary":"#FF4444","secondary":"#FF69B4","theme":"red"},"timestamp":"2026-02-20T06:53:59.414Z"}[ec2-user@ip-10-0-1-154 ~]$ curl -s http://localhost/health
        <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
        
        <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
            <head>
                <title>The page is not found</title>
                <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />     
            </head>
        
            <body>
                <h1><strong>nginx error!</strong></h1>
        
                <div class="content">
        
                    <h3>The page you are looking for is not found.</h3>
        
                    <div class="alert">
                        <h2>Website Administrator</h2>
                        <div class="content">
                            <p>Something has triggered missing webpage on your
                            website. This is the default 404 error page for
                            <strong>nginx</strong> that is distributed with
                            Fedora.  It is located
                            <tt>/usr/share/nginx/html/404.html</tt></p>
        
                            <p>You should customize this error page for your own
                            site or edit the <tt>error_page</tt> directive in
                            the <strong>nginx</strong> configuration file
                            <tt>/etc/nginx/nginx.conf</tt>.</p>
                        </div>
                    </div>
        
                    <div class="logos">
                        <a href="http://nginx.net/"><img
                            src="/nginx-logo.png"
                            alt="[ Powered by nginx ]"
                            width="121" height="32" /></a>
        
                        <a href="http://fedoraproject.org/"><img
                            src="/poweredby.png"
                            alt="[ Powered by Fedora ]"
                            width="88" height="31" /></a>
                    </div>
                </div>
            </body>
        </html>
        ```
        
        **ì›ì¸**: `nginx.conf` ì•ˆì— **ê¸°ë³¸ ì„œë²„ ë¸”ë¡**ì´ ìˆì–´ì„œ `pixelflora.conf`ì™€ ì¶©ëŒ.
        
        **í•´ê²° ë°©ì‹:** `setup_ami_base.sh`ì˜ Nginx ì„¤ì •ì—ì„œ ê¸°ë³¸ ì„œë²„ ë¸”ë¡ ì œê±°. â†’ pixelflora.conf ê°€ ìš°ì„ ê¶Œì„ ê°€ì§.
        
        ```
          # Remove the default server block from nginx.conf so it doesn't conflict
          # with pixelflora.conf (both claim server_name _ on port 80)
          cat > /etc/nginx/nginx.conf << 'NGINXMAINEOF'
        user nginx;
        worker_processes auto;
        error_log /var/log/nginx/error.log notice;
        pid /run/nginx.pid;
        
        include /usr/share/nginx/modules/*.conf;
        
        events {
            worker_connections 1024;
        }
        
        http {
            log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                              '$status $body_bytes_sent "$http_referer" '
                              '"$http_user_agent" "$http_x_forwarded_for"';
        
            access_log  /var/log/nginx/access.log  main;
        
            sendfile            on;
            tcp_nopush          on;
            keepalive_timeout   65;
            types_hash_max_size 4096;
        
            include             /etc/nginx/mime.types;
            default_type        application/octet-stream;
        
            include /etc/nginx/conf.d/*.conf;
        }
        NGINXMAINEOF
        
          # â”€â”€ Nginx: serves the React build + proxies /api and /socket.io to backend â”€â”€
          cat > /etc/nginx/conf.d/pixelflora.conf << 'NGINXEOF'
        server {
            listen 80;
            server_name _;
        ```
        
- **26.02.24**
    - Terraformì„ ì‚¬ìš©í•œ ì¸í”„ë¼ ì„¤ì • ìë™í™”
        
        ```jsx
        terraform {
          required_version = ">= 1.5"
          required_providers {
            aws = {
              source  = "hashicorp/aws"
              version = "~> 5.0"
            }
          }
          # Uncomment to use S3 backend for team collaboration:
          # backend "s3" {
          #   bucket = "your-tfstate-bucket"
          #   key    = "pixelflora/terraform.tfstate"
          #   region = "ap-northeast-2"
          # }
        }
        
        provider "aws" {
          region = var.aws_region
        }
        
        module "networking" {
          source       = "./modules/networking"
          project_name = var.project_name
        }
        
        module "database" {
          source       = "./modules/database"
          project_name = var.project_name
          vpc_id       = module.networking.vpc_id
          subnet_ids   = module.networking.private_subnet_ids
          ec2_sg_id    = module.compute.ec2_sg_id
        }
        
        module "compute" {
          source            = "./modules/compute"
          project_name      = var.project_name
          vpc_id            = module.networking.vpc_id
          public_subnet_ids = module.networking.public_subnet_ids
          ami_id            = var.ami_id
          instance_type     = var.instance_type
          key_name          = var.key_name
          min_size          = var.min_size
          max_size          = var.max_size
          desired_capacity  = var.desired_capacity
          cpu_target        = var.cpu_target
          redis_host        = module.database.redis_endpoint
        }
        ```
        
- **26.02.25**
    - Terraformì— í‚¤í˜ì–´ ì„¤ì • ì¶”ê°€
    - CPU ë¶€í•˜(Storm mode)ì˜ ì§€ì† ì‹œê°„ ì‚­ì œ ë° ìŠ¤ì¼€ì¼ ì•„ì›ƒ CPU ë¶€í•˜ ê¸°ì¤€ ë³€ê²½(60% â†’ 40%)
        
        ```jsx
        export default function StormButton({ stormActive, onStart, onStop }) {
          return (
            <div style={styles.container}>
              <div style={styles.label}>â›ˆ Storm Mode</div>
              <div style={styles.row}>
                {stormActive ? (
                  <button onClick={onStop} style={{ ...styles.btn, ...styles.stopBtn }}>
                    â–  í­í’ ì¤‘ë‹¨
                  </button>
                ) : (
                  <button onClick={onStart} style={{ ...styles.btn, ...styles.startBtn }}>
                    â–¶ í­í’ ì‹œì‘
                  </button>
                )}
              </div>
              {stormActive && (
                <div style={styles.warning}>
                  CPU ë¶€í•˜ ì¤‘... Auto Scaling íŠ¸ë¦¬ê±° ëŒ€ê¸° ì¤‘
                </div>
              )}
            </div>
          );
        }
        
        const styles = {
          container: {
            padding: '12px 16px',
            background: '#161b22',
            borderRadius: 8,
            border: '1px solid #30363d',
          },
          label: { fontWeight: 'bold', marginBottom: 8, color: '#e6edf3' },
          row: { display: 'flex', alignItems: 'center', gap: 12 },
          btn: {
            padding: '6px 16px',
            border: 'none',
            borderRadius: 6,
            cursor: 'pointer',
            fontWeight: 'bold',
            fontSize: 14,
          },
          startBtn: { background: '#1f6feb', color: '#fff' },
          stopBtn: { background: '#f85149', color: '#fff' },
          warning: {
            marginTop: 8,
            fontSize: 12,
            color: '#d29922',
            animation: 'pulse 1.5s infinite',
          },
        };
        
        // variables.tf
        variable "cpu_target" {
          description = "Target CPU utilization (%) for Target Tracking scaling policy"
          type        = number
          default     = 40
        }
        
        ```
        
    - ì¸ìŠ¤í„´ìŠ¤ì˜ ìƒ‰ìƒ ë§¤í•‘ ë°©ì‹ ë³€ê²½(ëœë¤ â†’ redisì—ì„œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ìƒ‰ ìš°ì„ )
        
        ```jsx
        // Pick a color key not already used by any active instance in Redis
        async function pickAvailableColorKey(instanceId) {
          const allKeys = Object.keys(INSTANCE_COLOR_MAP);
          try {
            const raw = await redisClient.hgetall('instances');
            if (!raw) return allKeys[0];
        
            const usedKeys = new Set();
            for (const [id, value] of Object.entries(raw)) {
              if (id === instanceId) continue; // skip self in case of re-registration
              const data = JSON.parse(value);
              if (!data.active) continue;
              for (const [key, colorConfig] of Object.entries(INSTANCE_COLOR_MAP)) {
                if (data.color && data.color.primary === colorConfig.primary) {
                  usedKeys.add(key);
                  break;
                }
              }
            }

        ```
